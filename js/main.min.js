$(document).ready(function(){if($(".main-page").length>=1){function e(e){for(var t,n=1;n<=Object.keys(window.events).length;n++)window.events[n]===e?(e.active=!0,t=n):window.events[n].active=!1;a(e.array,window.show_events,t),window.show_events=e.array,window.show_events.index=t}function t(){for(var e=$(".scroll-path"),t=1;t<=Object.keys(window.events).length;t++)e.append('<div class="scroll-path__item" data-index="'+t+'">\n                        <span class="scroll-path__item-line"></span>\n                    </div>')}function n(e,t){if(window.mobile)$(".event-wrapper").append('<span class="list"></span>'),e.forEach(function(e){var t=!0===e.pay_btn?"event":"event event--no-pay",n=null===e.desc?"":e.desc;$(".list").append('            <a href="'+e.link+'" class="'+t+'">\n                    <span class="event__img"><span class="event__bg"></span><img src="'+e.img+'" alt=""></span>\n                    <span class="event__info">\n                        <span class="event__info-top">\n                            <p class="event__date">'+e.date+'</p>\n                            <h3 class="event__name">'+e.name+'</h3>\n                            <p class="event__desc">'+n+'</p>\n                        </span>\n                        <span class="event__btn btn" id="'+e.id+'" data-radario-event-id="'+e.radario_id+'">купить билет</span>\n<script data-custom-button-id="'+e.id+'" data-event-id="'+e.radario_id+'" data-custom-name="Купить билет" data-class="radarioButtonScript" src="https://radario.ru/scripts/widget/buy-button-widget.js" id="radario-widget-12.318613760939723"><\/script>\n                    </span>\n                </a>')});else{var n=9;$(window).width()>=1441&&(n=12),e.forEach(function(e){var n=!0===e.pay_btn?"event":"event event--no-pay",a=null===e.desc?"":e.desc;t.append('            <a href="'+e.link+'" class="'+n+'">\n                    <span class="event__img"><span class="event__bg"></span><img src="'+e.img+'" alt=""></span>\n                    <span class="event__info">\n                        <span class="event__info-top">\n                            <p class="event__date">'+e.date+'</p>\n                            <h3 class="event__name">'+e.name+'</h3>\n                            <p class="event__desc">'+a+'</p>\n                        </span>\n                        <span class="event__btn btn" id="'+e.id+'" data-radario-event-id="'+e.radario_id+'">купить билет</span>\n<script data-custom-button-id="'+e.id+'" data-event-id="'+e.radario_id+'" data-custom-name="Купить билет" data-class="radarioButtonScript" src="https://radario.ru/scripts/widget/buy-button-widget.js" id="radario-widget-12.318613760939723"><\/script>\n                    </span>\n                </a>')});var a=t.find(".event").length;if(a<n)for(var o=1;o<=n-a;)t.append('            <div class="event event--empty">\n                    <span class="event__img"></span>\n                    <span class="event__info">\n                        <span class="event__info-top">\n                            <p class="event__date"></p>\n                            <h3 class="event__name"></h3>\n                            <p class="event__desc"></p>\n                        </span>\n                    </span>\n                </div>'),o++}}function a(e,t,a){var o=t.index<a;console.log(o,t.index,window.show_events.index);var s=$(".list"),i=$(".event-wrapper");if(0===s.length)i.append('<span class="list"></span>'),n(e,i.find(".list"));else{$(".list--old").remove(),s.addClass("list--old"),i.append('<span class="list"></span>'),n(e,$(".list:not(.list--old)"));$(".list--old");var r=new TimelineMax({paused:!0,onComplete:function(){}}),l=$(".list:not(.list--old) .event"),c=[],d=[],p=0,_=$(".list--old .event");l.each(function(e){e%window.elems_count==0&&p++,c[p]||(c[p]=[]),c[p].push($(this))}),_.each(function(e){e%window.elems_count==0&&p++,d[p]||(d[p]=[]),d[p].push($(this))});function h(e,t,n,a,s){var i={},l={one:{duration:.5,delay:.1,direction:"x",size:"100%"},two:{duration:.7,delay:0,direction:"y",size:"-100%"}};n?i=l:(i.one=l.two,i.two=l.one),o||(l.one.size="-100%",l.one.direction="y",l.two.size="100%",l.two.direction="x",r.add(TweenMax.set(".list--old",{"z-index":1})),r.set(".list:not(.list--old) .event__info ",{"z-index":0})),$(".list").css("pointer-events","none"),setTimeout(function(){$(".list:not(.list--old)").css("pointer-events","auto"),r.set(".list:not(.list--old) .event__info ",{"z-index":1})},1e3);var c=t%2==0?i.one:i.two,d={ease:Power1.easeOut};d[c.direction]=c.size,r.add(TweenMax.set(e.find(".event__bg"),{"background-color":s})),r.add("scene").from(e.find(".event__img"),c.duration,d,0).from(e.find(".event__bg"),c.duration+.1,{opacity:.8,ease:Power1.easeOut},0).from(e.find(".event__info"),c.duration,{opacity:0},.5),o&&r.to(".list--old",.5,{opacity:0,ease:Power1.easeIn},.3)}var v=0,m=["#EE2324","#ffffff","#000000"],u=0,w=m.length-1;(o?c:d).forEach(function(e,t){t%2==0?e.forEach(function(e,t){h(e,t,!0,0,m[u]),u=u===m.length-1?0:u+1}):e.forEach(function(e,t){h(e,t,!1,0,m[w]),w=0===w?m.length-1:w-1}),(v+=.2)-.3}),r.restart(),o||r.reverse(-.6)}}function o(e){var n=0,a={},o=[];$.each(window.events,function(e,t){t.array.forEach(function(e){o.push(e)})}),o.forEach(function(t,o){o%e==0&&n++,a[n]||(a[n]={array:[],active:!1}),a[n].array.push(t)}),window.show_events=a[1].array.slice(),a[1].active=!0,window.events=a,$(".scroll-path__item").remove(),t()}window.show_events=[],window.events={};var s=null!=navigator.userAgent.match(/iPad/i),i=$(window).width(),r=9;window.elems_count=3,i>=1441&&(r=12,window.elems_count=4),window.mobile=i<=850||s;$.ajax({type:"GET",url:"/events/index/get-list-events",success:function(e){var o=0,s={};e.events.forEach(function(e,t){$(".image-preload").append('<img src="'+e.img+'"/>'),t%r==0&&o++,s[o]||(s[o]={array:[],active:!1}),s[o].array.push(e)}),window.mobile?(arr_mobile=[],e.events.forEach(function(e){arr_mobile.push(e)}),n(arr_mobile)):(window.show_events=s[1].array.slice(),window.show_events.index=1,s[1].active=!0,window.events=s,setTimeout(function(){$(".scroll-path__item[data-index=1]").addClass("scroll-path__item--active")}),console.log(window.show_events,window.events),t(),a(window.show_events,window.show_events))},error:function(e){console.log("возникла ошибка",e)}});var l=!0;function c(t,n){n||e(window.events[t.data("index")]);var a=$(".scroll-path__item--active").data("index");$(".scroll-path__item").removeClass("scroll-path__item--active");var o=$(".scroll-path__item[data-index="+window.show_events.index+"]");o.addClass("scroll-path__item--active"),num=window.show_events.index-a;new TimelineMax;1!==num&&-1!==num||(1===num?(o.addClass("scroll-path__item-animate-bottom"),setTimeout(function(){o.removeClass("scroll-path__item-animate-bottom")},1e3)):-1===num&&(o.addClass("scroll-path__item-animate-top"),setTimeout(function(){o.removeClass("scroll-path__item-animate-top")},1e3)))}$(window).resize(function(e){$(window).width()>=1441?(l=4===window.elems_count,r=12,window.elems_count=4,l||(o(r),l=!l)):(l=3===window.elems_count,r=9,window.elems_count=3,l||(o(r),l=!l)),window.mobile=$(window).width()<=768}),$(document).on("click",".scroll-path__item",function(){c($(this))});var d=document.querySelector(".event-wrapper");d.addEventListener?"onwheel"in document?d.addEventListener("wheel",_):"onmousewheel"in document?d.addEventListener("mousewheel",_):d.addEventListener("MozMousePixelScroll",_):d.attachEvent("onmousewheel",_);var p=!1;function _(t){if(!p){var n,a=(t=t||window.event).deltaY||t.detail||t.wheelDelta;n="bottom"===(a>0?"bottom":"top")?1:-1,$.each(window.events,function(t,a){if(!0===a.active&&window.events[Number(t)+n])return e(window.events[Number(t)+n]),c($(".scroll-path__item[data-index="+Number(t)+n+"]"),!0),!1}),p=!0,setTimeout(function(){p=!1},1e3),t.preventDefault?t.preventDefault():t.returnValue=!1}}}if($(".sidebar__search--search-icon").click(function(){""===$(".header-search__wrap input").val()?($(".header-search__wrap").toggleClass("header-search__wrap--hide"),$(".sidebar__search").toggleClass("sidebar__search--open")):$(".header-search__wrap form").submit()}),$(".sidebar__search--close-icon").click(function(){$(".sidebar__search").removeClass("sidebar__search--open"),$(".header-search__wrap").toggleClass("header-search__wrap--hide")}),$("#map").length>=1?(ymaps.ready(function(){var e=new ymaps.Map("map",{center:[59.90666,30.307461],zoom:16,controls:[]},{searchControlProvider:"yandex#search"}),t=(ymaps.templateLayoutFactory.createClass('<div style="color: #FFFFFF; font-weight: bold;">$[properties.iconContent]</div>'),new ymaps.Placemark([59.906681,30.307429],{hintContent:"Клуб зал ожидания",balloonContent:"197136 Санкт-Петербург, улица Рентгена, 7"}));e.behaviors.disable("scrollZoom"),e.controls.add(new ymaps.control.ZoomControl({options:{position:{left:10,top:250}}})),e.geoObjects.add(t)}),$(".header__right-adress").click(function(){$("html, body").animate({scrollTop:$(".footer__adress-wrap").offset().top},1e3)})):$(".header__right-adress").addClass("header__right-adress--disable"),$(".header__mobile-icon").click(function(){$(this).toggleClass("header__mobile-icon--open"),$("html").toggleClass("overflow-hidden"),$(".header__nav").toggleClass("header__nav--open")}),$(".e-top").length>=1){$(".e-sharing__img ").fancybox(),0!==$(".e-sharing__img img").length&&0!==$(".e-sharing__img img").height()||$(".e-info__top, .e-info__bottom").addClass("e-info--no-image"),0===$(".e-image").length&&$(".e-text").addClass("e-text--archive");var h=!1;function v(){!1!==h&&0!==$(".e-image__mobile").length||($(".e-top__left").prepend('<div class="e-image__mobile"></div>'),$(".e-image__mobile").append($(".e-image").html()),h=!0)}$(window).width()<=660&&v(),$(window).resize(function(){v()})}if($(".e-archive").length>=1&&$("body").addClass("event-archive"),$(".rent-content").length>=1){$("body").addClass("rent-wrapper"),$(".rent-calend__slider-item").fancybox(),$(".rent-calend__slider").slick({dots:!0,speed:1e3,autoplay:!0,pauseOnHover:!1,fade:!0,slidesToShow:1,variableWidth:!1,arrows:!1});var m=[];$(".calendar-days-hidden span").each(function(e){var t=$(this).text();m[e]={date:t}});var u=$(".cal1").clndr({moment:moment,events:m,clickEvents:{click:function(e){var t=!0;u.options.events.forEach(function(n){n.date===e.date._i&&(t=!1)}),t?(u.addEvents([{date:e.date._i}]),w()):(u.removeEvents(function(t){return t.date===e.date._i}),w()),console.log(u.options.events)},today:function(){console.log("Cal-1 today")},nextMonth:function(){w()},previousMonth:function(){w()},onMonthChange:function(){console.log("Cal-1 month changed")},nextYear:function(){console.log("Cal-1 next year")},previousYear:function(){console.log("Cal-1 previous year")},onYearChange:function(){console.log("Cal-1 year changed")},nextInterval:function(){console.log("Cal-1 next interval")},previousInterval:function(){console.log("Cal-1 previous interval")},onIntervalChange:function(){console.log("Cal-1 interval changed")}},daysOfTheWeek:["ПН","ВТ","СР","ЧТ","ПН","СБ","ВС"],targets:{day:"day",empty:"empty",nextButton:"clndr-next-button",todayButton:"clndr-today-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button"},classes:{past:"past",today:"today",event:"day-event",selected:"selected",inactive:"inactive",lastMonth:"last-month",nextMonth:"next-month",adjacentMonth:"adjacent-month"},doneRendering:function(e){m.forEach(function(e){$(".calendar-day-"+e.date).removeClass("day-event").addClass("day-disable")})}});function w(){$(".clndr-previous-button").text("‹"),$(".clndr-next-button").text("›")}w(),$(".rent-calend__btn").click(function(){var e=[],t=[],n=[];u.options.events.forEach(function(t){e.push(t.date)}),m.forEach(function(e){n.push(e.date)}),e.forEach(function(e){-1===n.indexOf(e)&&t.push(e)}),0!==t.length?($("html, body").animate({scrollTop:$(".rent-proposal__wrap").offset().top-64},1e3),t=String(t).replace(/,/g,";  "),$("#date").val(t)):($(".rent-calend__error").css("opacity",1),setTimeout(function(){$(".rent-calend__error").css("opacity",0)},1e3))})}if($(".ar-content").length>=1){var f=new LazyLoad;$(".footer__map, .footer__adress-wrap").hide();var g=[];function y(e){-1===g.indexOf(e)&&($.ajax({type:"GET",url:"/archive-year/"+String(e),success:function(t){!function(e,t){var n,a=$(".ar__year-wrapper[data-year="+e+"]");a.removeClass("ar__year-wrapper--empty");for(var o=0;o<=Object.keys(t).length-1;o++)a.append((n=t[o]).img?'  <a href="'+n.link+'" class="ar-item col-3">\n                          <span class="ar-item__inner-wrapper">\n                             <span class="ar-item__img">\n                                 <img data-src="'+n.img+'" alt="">\n                             </span>\n                             <span class="ar-item__date">'+n.date+'</span>\n                             <h3 class="ar-item__name">'+n.name+"</h3>\n                          </span>\n                    </a>":'  <a href="'+n.link+'" class="ar-item col-3">\n                          <span class="ar-item__inner-wrapper">\n                             <span class="ar-item__img ar-item__img--empty"></span>\n                             <span class="ar-item__date">'+n.date+'</span>\n                             <h3 class="ar-item__name">'+n.name+"</h3>\n                          </span>\n                    </a>");f.update(),setTimeout(function(){},400)}(e,t.events)},error:function(e){console.log("возникла ошибка",e)}}),g.push(e))}var b=$(".ar__year-wrapper").first();y($(".scroll-path__item").first().data("year")),b.removeClass("ar__year-wrapper--empty"),b.height()>415||(console.log(1231,$(".ar__year-wrapper:nth-child(2)")),$(".ar__year-wrapper:nth-child(2)").removeClass("ar__year-wrapper--empty"),y($(".scroll-path__item:nth-child(2)").data("year")));var x=$(".scroll-path__item--archive");x.click(function(){var e=$(this).text();$("html, body").animate({scrollTop:$(".ar__year-wrapper[data-year="+e+"]").offset().top-63},1e3)});var C=$(".scroll-path"),T=C.scrollTop()+C.height();$(".scroll-path__item-dots--next").css("top",T),$(window).resize(function(){T=C.scrollTop()+C.height(),$(".scroll-path__item-dots--next").css("top",T)}),$(".scroll-path__inner").height()-60<=C.height()?($(".scroll-path__item-dots--next").remove(),$(".scroll-path").css("overflow","hidden")):($(".scroll-path__item-dots--next").show(),C.niceScroll({scrollspeed:300,mousescrollstep:55,horizrailenabled:!1,cursorwidth:"0px",bouncescroll:!0,spacebarenabled:!1,cursorfixedheight:!0,enablemouselockapi:!1,nativeparentscrolling:!1,enablescrollonselection:!1,disablemutationobserver:!0})),C.on("scroll mousewheel touchmove",function(){C.scrollTop()>0?$(".scroll-path__item-dots--prev").fadeIn(200):$(".scroll-path__item-dots--prev").fadeOut(200),$(".scroll-path__inner").height()-50<=C.scrollTop()+C.height()?$(".scroll-path__item-dots--next").fadeOut(200):$(".scroll-path__item-dots--next").fadeIn(200)}),$(".scroll-path__item-dots--prev").click(function(){C.animate({scrollTop:0},400)}),$(".scroll-path__item-dots--next").click(function(){C.animate({scrollTop:C.height()+2e3},400)}),$(window).scroll(function(e){var t;clearTimeout($.data(this,"scrollTimer")),$(".ar__year-wrapper").each(function(){if(n=$(this),a=$(window).scrollTop(),$(n).offset().top<=a+400&&(t=$(this).data("year"),$("scroll-path__item--active").data("year")!==t)){x.removeClass("scroll-path__item--active"),$(".scroll-path__item[data-year="+t+"]").addClass("scroll-path__item--active");var e=$(".scroll-path__item--active").offset().top-$(".scroll-path__inner").offset().top-60;C.getNiceScroll(0).doScrollTop(e,300),count=1}var n,a}),$.data(this,"scrollTimer",setTimeout(function(){y(t)},50))})}});
